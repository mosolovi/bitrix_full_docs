[CRM](/api_help/crm/index.php)

[Классы](/api_help/crm/classes/index.php)

[CCRMActivity](/api_help/crm/classes/crm_activity/index.php)

Add

Add
===

Включить вкладки

Описание и параметры

Примеры использования

### Описание и параметры

```
integer
CCrmActivity::Add(
	array arFields,
	bool checkPerms = true, 
	bool regEvent = true, 
	array options
);Копировать
```

Метод служит для добавления нового Дела. Метод статический.

#### Параметры вызова

| Параметр | Описание | С версии |
| --- | --- | --- |
| arFields | Массив параметров Дела, содержит следующие поля:  * **TYPE\_ID** - числовой идентификатор типа дела.    В классе-справочнике \CCrmActivityType описаны 4 стандартных типа дела, которые были ранее (Встреча, Звонок, Задача, Email). Для новых дел необходимо проставлять тип \CCrmActivityType::Custom. * **PROVIDER\_ID** - строковый идентификатор провайдера.    ID зарегистрированного провайдера. Должен состоять из названия модуля и сущности, например VOXIMPLANT\_CALL. * **PROVIDER\_TYPE\_ID** - cтроковый идентификатор типа дела провайдера.    Идентификатор типа дела в рамках провайдера дела. (Когда один провайдер генерирует свои подтипы дел). * **BINDINGS** - массив привязки к сущностям CRM.    Должна быть как минимум одна привязка к сущности CRM.    ```   $arFields['BINDINGS'][] = array(   	'OWNER_ID' => $crmEntity['ENTITY_ID'],   	'OWNER_TYPE_ID' => $crmEntity['ENTITY_TYPE']   );Копировать   ``` * **ASSOCIATED\_ENTITY\_ID** - ID сущности, которое порождает дело (если есть). Число. Например, для дел типа Задача - здесь хранится ID задачи. * **SUBJECT** - тема (Название) дела.  "Исходящий звонок с Владимиром". * **COMPLETED** - флаг завершенности дела (Y/N).  Используется, когда дело имеет понятие "дело выполнено", "дело не выполнено". * **RESPONSIBLE\_ID** - ID ответственного пользователя.  ID пользователя, который назначен ответственным за выполение дела. * **PRIORITY** - числовой идентификатор приоритета дела.  Значение берется из класса-справочника \CCrmActivityPriority. В новом планировщике останется только пометка "Важное дело", поэтому имеет смысл использовать, либо \CCrmActivityPriority::Medium либо \CCrmActivityPriority::High. * **NOTIFY\_TYPE** - числовой идентификатор типа напоминания.  Значения берутся из \CCrmActivityNotifyType. Минуты, часы, дни. * **NOTIFY\_VALUE** - числовое значение напоминания.  За сколько минут (часов, дней) необходимо напомнить о деле. * **DESCRIPTION** - описание, текст.  Поле "Описание дела". * **DESCRIPTION\_TYPE** - тип описания.  Значения из справочника \CCrmContentType (PlainText, BBCode, Html). * **DIRECTION** - направление.  Справочник \CCrmActivityDirection. Бывают входящие и исходящие дела. * **LOCATION** - место проведения, текст.  На данный момент используется в деле типа Встреча. * **START\_TIME** - дата начала дела (datetime). * **END\_TIME** - дата завершения дела (datetime).  Устанавливается для дел с продолжительностью выполнения. * **STORAGE\_TYPE\_ID** - тип хранилища для вложений.  Хранилище по умолчанию CCrmActivity::GetDefaultStorageTypeID(). * **STORAGE\_ELEMENT\_IDS** - массив ID вложений.  Массив с ID объектов указанного типа хранилища. * **PARENT\_ID** - ID дела-родителя.  На данный момент используется в типе дела Email. Будет использовано для построения цепочки дел. * **AUTHOR\_ID** - ID cоздателя.  ID пользователя, создавшего дело. * **ORIGINATOR\_ID** - идентификатор внешней информационной базы.  Используется для связи с внешними сущностями (1C). * **ORIGIN\_ID** - идентификатор сущности во внешней информационной базе.  Используется для связи с внешними сущностями (1C, Voximplant). * **PROVIDER\_PARAMS** - массив параметров провайдера.  Зарезервированное текстовое поле для параметров провайдера. **Принимает только массив**. * **PROVIDER\_DATA** - данные провайдера в произвольном виде (longtext).  Зарезервированное текстовое поле для данных провайдера. * **RESULT\_VALUE** - число (формат 18.4).  Коэффициент "важности" дела, для расчета коммуникационной нагрузки. У каждого типа дел может быть свой. Например, для звонков - продолжительность звонка. * **RESULT\_SUM** - число (формат 18.4).  Сумма вырученных денег. * **RESULT\_CURRENCY\_ID** - строка (3 символа).  Код валюты вырученных денег. |  |
| checkPerms | Параметр проверяет права на Дело. Может принимать значения *true* или *false*. |  |
| regEvent | Параметр указывает, регистрировать ли Дело в Истории CRM. Может принимать значения *true* или *false*. |  |
| options | Массив дополнительных параметров, содержит следующие поля:  * **SKIP\_CALENDAR\_EVENT** - не добавлять запись в Календарь.  true или false. * **REGISTER\_SONET\_EVENT** - создавать запись в Живой ленте.  true или false. | с версии 12.0.7 |

#### Возвращаемые значения

Возвращает идентификатор ID созданного Дела.

### Примеры использования

```
$ID = CCrmActivity::Add($arFields, false, true, array('REGISTER_SONET_EVENT' => true));
if($ID > 0)
{
	CCrmActivity::SaveCommunications($ID, $arComms, $arFields, true, false);
}Копировать
```

Новинки документации в соцсетях: