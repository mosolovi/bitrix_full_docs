[Форум](/api_help/forum/index.php)

[Функции](/api_help/forum/functions/index.php)

ForumAddMessage (доступно с 3.3.3)

ForumAddMessage
===============

```
int
ForumAddMessage(
	string MESSAGE_TYPE,
	int FID,
	int TID,
	int MID,
	array arFieldsG,
	&string strErrorMessage,
	&string strOKMessage [,
	int iFileSize]
);Копировать
```

Добавляет или изменяет сообщение (и возможно тему) форума. В переменную, передаваемую в параметре *strErrorMessage* дописывает ошибки, которые произошли при работе функции. В переменную, передаваемую в параметре *strOKMessage* дописывает сообщения об успехах, которые произошли при работе функции.

**Примечание**. Функция использует внутреннюю транзакцию. Если у вас используется **MySQL** и **InnoDB**, и ранее была открыта транзакция, то ее необходимо закрыть до ее подключения.

#### Параметры функции

| Параметр | Описание |
| --- | --- |
| MESSAGE\_TYPE | Тип работы функции. Может принимать следующие значения: NEW - создание новой темы и добавление в нее сообщения, EDIT - изменение сообщения (и темы, если на это есть права), REPLY - новое сообщение в существующую тему. |
| FID | Код форума, в который добавляется новая тема. Актуален для типа работы NEW, в остальных случаях восстанавливается из кода темы. |
| TID | Код темы, в которую добавляется сообщение. Актуален для типа работы REPLY, в остальных случаях восстанавливается из кода сообщения. Для добавления новой темы должен быть равен 0. |
| MID | Код сообщения, которое необходимо изменить. Актуален для типа работы EDIT. В остальных случаях должен быть равен 0. |
| arFieldsG | Массив параметров сообщения и темы. Должен содержать следующие ключи  POST\_MESSAGE - тело сообщения,  TITLE - заголовок темы (если NEW или EDIT и разрешено изменение темы),  AUTHOR\_NAME - имя автора сообщения,  DESCRIPTION - описание темы (если NEW или EDIT и разрешено изменение темы),  ICON\_ID - иконка темы (если NEW или EDIT и разрешено изменение темы),  USE\_SMILES - разрешено заменять смайлики на их графические изображения,  ATTACH\_IMG - присоединенный файл - массив со структурой элементов массива $\_FILES |
| strErrorMessage | Переменная, в которую функция дописывает сообщения об ошибках, которые произошли при ее работе. |
| strOKMessage | Переменная, в которую функция дописывает сообщения об успехах, которые произошли при ее работе. |
| iFileSize | Максимальный размер загружаемых файлов в байтах. Не обязательный параметр, по умолчанию равен 50000 (байт). |
| captcha\_word | Слово с капчи. |
| captcha\_sid | Сессия капчи. |
| captcha\_code | Введенное пользователем слово. |

#### Возвращаемое значение

Возвращает ID сообщения, если функция отработала без ошибок. В противном случае возвращает False.

Следует помнить, что внутри функции используется глобальная переменная **$USER**. То есть, сообщение запишется в базу от текущего авторизованного пользователя.

Новинки документации в соцсетях: