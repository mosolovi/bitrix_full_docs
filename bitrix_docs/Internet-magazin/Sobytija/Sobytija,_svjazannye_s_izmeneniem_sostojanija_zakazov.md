[Интернет-магазин](/api_help/sale/index.php)

[События](/api_help/sale/events/index.php)

События, связанные с изменением состояния заказов

События, связанные с изменением состояния заказов
=================================================

**Примечание:** перечисленные ниже события устарели с версии 15.5.0, но в продукте сохранена обратная совместимость. Поэтому их можно использовать, если в настройках модуля **Интернет-магазин** отмечена опция **Включить обработку устаревших событий**. Либо вы можете использовать [события нового ядра](http://dev.1c-bitrix.ru/api_d7/bitrix/sale/events/index.php).

| Событие | Описание и параметры | Метод | С версии | До версии |
| --- | --- | --- | --- | --- |
| OnSaleBeforePayOrder | Вызывается перед изменением флага оплаты заказа, может быть использовано для отмены.   **Параметры**  |  |  | | --- | --- | | *ID* | Идентификатор заказа | | *val* | Флаг оплаты (Y - оплатить заказ, N - снять оплату заказа) | | *bWithdraw* | Значение true отражает изменение флага на внутреннем счете пользователя; значение false изменяет только флаг, не затрагивая счет | | *bPay* | Если параметр bWithdraw установлен в true, то установка параметра bPay в true приведет к тому, что необходимая сумма денег будет внесена на счет покупателя перед оплатой, а установка в false приведет к тому, что оплата будет происходить целиком с внутреннего счета; если параметр bWithdraw установлен в false, то операции со счетом не производятся и значение параметра bPay не играет роли. | | *recurringID* | Должен быть равен 0 | | *arAdditionalFields* | Массив дополнительно обновляемых параметров (обычно это номер и дата платежного поручения) | | [PayOrder](/api_help/sale/classes/csaleorder/csaleorder__payorder.88101c0f.php) | 4.0.6 | 15.5.0 |
| OnSalePayOrder | Вызывается после изменения флага оплаты заказа.   **Параметры**  |  |  | | --- | --- | | *ID* | Идентификатор заказа | | *val* | Флаг оплаты (Y - выставление оплаты, N - снятие оплаты) | | [PayOrder](/api_help/sale/classes/csaleorder/csaleorder__payorder.88101c0f.php) | 4.0.6 | 15.5.0 |
| OnSaleBeforeDeliveryOrder | Вызывается перед изменением флага разрешения доставки заказа, может быть использовано для отмены.   **Параметры**  |  |  | | --- | --- | | *ID* | Идентификатор заказа | | *val* | Флаг разрешения доставки (Y - разрешено, N - запрещено) | | *recurringID* | Должен быть равен 0 | | *arAdditionalFields* | Массив дополнительно обновляемых параметров (обычно это номер и дата документа отгрузки) | | [DeliverOrder](/api_help/sale/classes/csaleorder/csaleorder__deliverorder.fd0e66d5.php) | 4.0.6 | 15.5.0 |
| OnSaleDeliveryOrder | Вызывается после изменения флага разрешения доставки заказа.   **Параметры**  |  |  | | --- | --- | | *ID* | Идентификатор заказа | | *val* | Флаг разрешения доставки (Y - разрешено, N - запрещено) | | [DeliverOrder](/api_help/sale/classes/csaleorder/csaleorder__deliverorder.fd0e66d5.php) | 4.0.6 | 15.5.0 |
| OnSaleBeforeCancelOrder | Вызывается перед изменением флага отмены заказа, может быть использовано для отмены.   **Параметры**  |  |  | | --- | --- | | *ID* | Идентификатор заказа | | *val* | Флаг отмены заказа (Y - отменено, N - не отменено) | | [CancelOrder](/api_help/sale/classes/csaleorder/csaleorder__cancelorder.fa562b77.php) | 4.0.6 | 15.5.0 |
| OnSaleCancelOrder | Вызывается после изменения флага отмены заказа.   **Параметры**  |  |  | | --- | --- | | *orderId* | Идентификатор заказа | | *value* | Флаг отмены заказа (Y - отменено, N - не отменено) | | *description* | Причина отмены. Изменить это поле нельзя, только чтение. | | [CancelOrder](/api_help/sale/classes/csaleorder/csaleorder__cancelorder.fa562b77.php) | 4.0.6 | 15.5.0 |
| OnSaleBeforeStatusOrder | Вызывается перед изменением статуса заказа, может быть использовано для отмены.   **Параметры**  |  |  | | --- | --- | | *ID* | Идентификатор заказа | | *val* | Идентификатор статуса | | [StatusOrder](/api_help/sale/classes/csaleorder/csaleorder__statusorder.f21c0322.php) | 4.0.6 | 15.5.0 |
| OnSaleStatusOrder | Вызывается после изменения статуса заказа.   **Параметры**  |  |  | | --- | --- | | *ID* | Идентификатор заказа | | *val* | Идентификатор статуса | | [StatusOrder](/api_help/sale/classes/csaleorder/csaleorder__statusorder.f21c0322.php) | 4.0.6 | 15.5.0 |

**Обратите внимание, что** события **OnSaleBeforeStatusOrder** и **OnSaleStatusOrder** не вызываются в момент создания заказа, поэтому перевод в статус N (Принят) может быть инициировано только вручную. В таком случае, можно инициировать вызов своего обработчика на смену статуса через обработчик на создание заказа. Например так:

```
public static function OnOrderAddHandler($ID, $arFields) 
{
	self::OnSaleStatusOrderHandler($ID, $arFields['STATUS_ID']);
}Копировать
```

Новинки документации в соцсетях: